# Stateful (Lab 13)

Followed tutorial.

```
rostislav@rostislavpc:~/devops_labs/k8s$ helm install stateful ./helm-app
NAME: stateful
LAST DEPLOYED: Tue Apr 30 22:19:42 2024
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch the status of by running 'kubectl get --namespace default svc -w stateful-helm-app'
  export SERVICE_IP=$(kubectl get svc --namespace default stateful-helm-app --template "{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}")
  echo http://$SERVICE_IP:80
rostislav@rostislavpc:~/devops_labs/k8s$ kubectl get po,sts,svc,pvc
NAME                      READY   STATUS    RESTARTS   AGE
pod/stateful-helm-app-0   1/1     Running   0          51s
pod/stateful-helm-app-1   1/1     Running   0          51s

NAME                                 READY   AGE
statefulset.apps/stateful-helm-app   2/2     51s

NAME                        TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
service/kubernetes          ClusterIP      10.96.0.1       <none>        443/TCP        2m1s
service/stateful-helm-app   LoadBalancer   10.103.81.183   <pending>     80:31054/TCP   51s

NAME                                                               STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/persistent-volumemount-stateful-helm-app-0   Bound    pvc-f1ba7778-b0fd-4685-81c3-e4fb8957aac9   128Mi      RWO            standard       51s
persistentvolumeclaim/persistent-volumemount-stateful-helm-app-1   Bound    pvc-ece2ab7f-65b3-4f3a-ad55-b400b189ba44   128Mi      RWO            standard       51s
rostislav@rostislavpc:~/devops_labs/k8s$ kubectl get po,sts,svc,pvc
NAME                      READY   STATUS    RESTARTS   AGE
pod/stateful-helm-app-0   1/1     Running   0          107s
pod/stateful-helm-app-1   1/1     Running   0          107s

NAME                                 READY   AGE
statefulset.apps/stateful-helm-app   2/2     107s

NAME                        TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
service/kubernetes          ClusterIP      10.96.0.1       <none>        443/TCP        2m57s
service/stateful-helm-app   LoadBalancer   10.103.81.183   <pending>     80:31054/TCP   107s

NAME                                                               STATUS   VOLUME
CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/persistent-volumemount-stateful-helm-app-0   Bound    pvc-f1ba7778-b0fd-4685-81c3-e4fb8957aac9   128Mi      RWO            standard       107s
persistentvolumeclaim/persistent-volumemount-stateful-helm-app-1   Bound    pvc-ece2ab7f-65b3-4f3a-ad55-b400b189ba44   128Mi      RWO            standard       107s
rostislav@rostislavpc:~/devops_labs/k8s$ kubectl get po,sts,svc,pvc
NAME                      READY   STATUS    RESTARTS   AGE
pod/stateful-helm-app-0   1/1     Running   0          2m21s
pod/stateful-helm-app-1   1/1     Running   0          2m21s

NAME                                 READY   AGE
statefulset.apps/stateful-helm-app   2/2     2m21s

NAME                        TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
service/kubernetes          ClusterIP      10.96.0.1       <none>        443/TCP        3m31s
service/stateful-helm-app   LoadBalancer   10.103.81.183   <pending>     80:31054/TCP   2m21s


NAME                                                               STATUS   VOLUME
    CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/persistent-volumemount-stateful-helm-app-0   Bound    pvc-f1ba7778-b0fd-4685-81c3-e4fb8957aac9   128Mi      RWO            standard       2m21s
persistentvolumeclaim/persistent-volumemount-stateful-helm-app-1   Bound    pvc-ece2ab7f-65b3-4f3a-ad55-b400b189ba44   128Mi      RWO            standard       2m21s
rostislav@rostislavpc:~/devops_labs/k8s$ minikube service stateful-helm-app
|-----------|-------------------|-------------|---------------------------|
| NAMESPACE |       NAME        | TARGET PORT |            URL            |
|-----------|-------------------|-------------|---------------------------|
| default   | stateful-helm-app | http/80     | http://192.168.49.2:31054 |
|-----------|-------------------|-------------|---------------------------|
üèÉ  Starting tunnel for service stateful-helm-app.
|-----------|-------------------|-------------|------------------------|
| NAMESPACE |       NAME        | TARGET PORT |          URL           |
|-----------|-------------------|-------------|------------------------|
| default   | stateful-helm-app |             | http://127.0.0.1:37591 |
|-----------|-------------------|-------------|------------------------|
üéâ  Opening service default/stateful-helm-app in default browser...
üëâ  http://127.0.0.1:37591
‚ùóÔ∏è  Because you are using a Docker driver on linux, the terminal needs to be open to run it.
```

## Outputs


` kubectl exec pod/stateful-helm-app-1 -- cat volume/visits.txt `

```
rostislav@rostislavpc:~/devops_labs/k8s$ kubectl exec pod/stateful-helm-app-1 -- cat volume/visits.txt
22:20:15
22:20:15
22:20:15
22:20:25
22:20:25
22:20:35
22:20:35
22:20:45
22:20:45
22:20:55
22:20:55
22:21:5
22:21:5
22:21:15
22:21:15
22:21:25
22:21:25
22:21:35
22:21:35
22:21:45
22:21:45
22:21:55
22:21:55
22:22:5
22:22:5
22:22:15
22:22:15
22:22:25
22:22:25
22:22:35
22:22:35
22:22:45
22:22:45
22:22:55
22:22:55
22:23:5
22:23:5
22:23:9
22:23:15
22:23:15
22:23:25
22:23:25
22:23:30
22:23:35
22:23:35
22:23:44
22:23:45
22:23:45
22:23:46
22:23:55
22:23:55
22:24:5
22:24:5
22:24:15
22:24:15
22:24:25
22:24:25
22:24:35
22:24:35
22:24:45
22:24:45
22:24:55
22:24:55
22:25:5
22:25:5
22:25:15
22:25:15
22:25:25
22:25:25
22:25:35
22:25:35
22:25:45
22:25:45
22:25:55
22:25:55
```

` kubectl exec pod/stateful-helm-app-0 -- cat volume/visits.txt `

```
rostislav@rostislavpc:~/devops_labs/k8s$ kubectl exec pod/stateful-helm-app-0 -- cat volume/visits.txt
22:20:16
22:20:25
22:20:25
22:20:35
22:20:35
22:20:45
22:20:45
22:20:55
22:20:55
22:21:5
22:21:5
22:21:15
22:21:15
22:21:25
22:21:25
22:21:35
22:21:35
22:21:45
22:21:45
22:21:55
22:21:55
22:22:5
22:22:5
22:22:15
22:22:15
22:22:25
22:22:25
22:22:35
22:22:35
22:22:45
22:22:45
22:22:55
22:22:55
22:23:5
22:23:5
22:23:14
22:23:15
22:23:15
22:23:19
22:23:25
22:23:25
22:23:35
22:23:35
22:23:39
22:23:42
22:23:42
22:23:43
22:23:44
22:23:45
22:23:45
22:23:51
22:23:55
22:23:55
22:24:5
22:24:5
22:24:15
22:24:15
22:24:25
22:24:25
22:24:35
22:24:35
22:24:45
22:24:45
22:24:55
22:24:55
22:25:5
22:25:5
22:25:15
22:25:15
22:25:25
22:25:25
22:25:35
22:25:35
22:25:45
22:25:45
22:25:55
22:25:55
22:26:5
22:26:5
22:26:15
22:26:15
```

## Change ordering policy

Changing allows start, run and delete deployments.

```
rostislav@rostislavpc:~/devops_labs/k8s$ kubectl delete statefulset.apps/stateful-helm-app
statefulset.apps "stateful-helm-app" deleted
rostislav@rostislavpc:~/devops_labs/k8s$ kubectl get po,sts,svc,pvc
NAME                      READY   STATUS        RESTARTS   AGE
pod/stateful-helm-app-0   1/1     Terminating   0          6m3s
pod/stateful-helm-app-1   1/1     Terminating   0          5m20s

NAME                        TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
service/kubernetes          ClusterIP      10.96.0.1       <none>        443/TCP        20m
service/stateful-helm-app   LoadBalancer   10.103.81.183   <pending>     80:31054/TCP   19m

NAME                                                               STATUS   VOLUME
    CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/persistent-volumemount-stateful-helm-app-0   Bound    pvc-f1ba7778-b0fd-4685-81c3-e4fb8957aac9   128Mi      RWO            standard       19m
persistentvolumeclaim/persistent-volumemount-stateful-helm-app-1   Bound    pvc-ece2ab7f-65b3-4f3a-ad55-b400b189ba44   128Mi      RWO            standard       19m

```

```
rostislav@rostislavpc:~/devops_labs/k8s$ kubectl delete pod stateful-helm-app-1 stateful-helm-app-0
pod "stateful-helm-app-1" deleted
pod "stateful-helm-app-0" deleted
rostislav@rostislavpc:~/devops_labs/k8s$ kubectl get po,sts,svc,pvc
NAME                      READY   STATUS              RESTARTS   AGE
pod/stateful-helm-app-0   0/1     ContainerCreating   0          3s
pod/stateful-helm-app-1   0/1     ContainerCreating   0          3s

NAME                                 READY   AGE
statefulset.apps/stateful-helm-app   0/2     80s

NAME                        TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE
service/kubernetes          ClusterIP      10.96.0.1        <none>        443/TCP        26m
service/stateful-helm-app   LoadBalancer   10.101.136.254   <pending>     80:31111/TCP   80s

NAME                                                               STATUS   VOLUME
    CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/persistent-volumemount-stateful-helm-app-0   Bound    pvc-f1ba7778-b0fd-4685-81c3-e4fb8957aac9   128Mi      RWO            standard       24m
persistentvolumeclaim/persistent-volumemount-stateful-helm-app-1   Bound    pvc-ece2ab7f-65b3-4f3a-ad55-b400b189ba44   128Mi      RWO            standard       24m
```